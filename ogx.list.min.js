if(typeof OGX=="undefined")var OGX={};OGX.List=function(){function addToCache(a){for(var b in indexes)indexes[b][a[b]]=a}function removeFromCache(a){for(var b in indexes)delete indexes[b][a[b]]}function dynamicSort(a,b){return function(c,d){return c[a]<d[a]?b*-1:c[a]>d[a]?b:0}}function extract(a,b,c,d){if(a.hasOwnProperty(b)){var e=a[b];switch(c){case"substr":return e=e.substr(d[0],d[1]),e;case"numrange":return e=Number(e),Array.isArray(d)?(e=Math.floor(e/d[0]),d[2]==="pre"?e=d[1]+e*d[0]+" - "+d[1]+(e+1)*d[0]:e=e*d[0]+d[1]+" - "+(e+1)*d[0]+d[1]):(e=Math.floor(e/d),e=e*d+" - "+(e+1)*d),e;case"date":if(!Array.isArray(d)){if(d==="year")return e=e.substr(0,4),e;if(d==="month")return e=e.substr(0,7),e;if(d==="week")return e=e.substr(0,4)+" week "+moment(e).week(),e}return e=moment(e).unix(),e=Math.floor(e/(d[0]*60*60*24)),e=e*d[0]*60*60*24,e=moment(e*1e3).format(d[1])+" - "+moment(e*1e3+d[0]*1e3*60*60*24).format(d[1]),e;default:return e}}return!1}var filteringMode="and",filterCount=0,indexes=!1;arguments.length===1&&arguments[0]instanceof Array&&(arguments=arguments[0]);var array=Object.create(Array.prototype);array=Array.apply(array,arguments)||array;for(var method in OGX.List.prototype)OGX.List.prototype.hasOwnProperty(method)&&(array[method]=OGX.List.prototype[method]);return array.insert=function(a,b){return typeof b=="undefined"?array.push(a):array.splice(b,0,a),indexes&&addToCache(a),!0},array.delete=function(a){var b=array.splice(a,1);return b.length?(indexes&&removeFromCache(b[0]),b[0]):!1},array.last=function(){if(this.length)return this[this.length-1];return},array.findDelete=function(a,b,c){var d=0;typeof c=="undefined"&&(c=0);var e=new OGX.List;for(var f=0;f<this.length;f++)if(this[f][a]===b){e.push(this.splice(f,1)[0]),indexes&&removeFromCache(e.last()),d++;if(c>0&&c===d)return c===1?e[0]:e;f--}return e},array.findReplace=function(a,b,c,d){var e=0;typeof d=="undefined"&&(d=0);var f=new OGX.List;for(var g=0;g<this.length;g++)if(this[g][a]===b){f.push(this[g]),e++,this[g]=c;if(d>0&&d===e)return d===1?f[0]:f}return f.length?f:!1},array.findUpdate=function(a,b,c,d,e){var f=0;typeof d=="undefined"&&(d=!1),typeof e=="undefined"&&(e=0);var g=new OGX.List,h;for(var i=0;i<this.length;i++)if(this[i][a]===b){h=!1;for(var j in c)d?this[i].hasOwnProperty(j)&&(this[i][j]=c[j],h=!0,f++):(this[i][j]=c[j],h=!0,f++);if(h){g.push(this[i]);if(e>0&&e===f)return e===1?g[0]:g}}return g.length?g:!1},array.findIndex=function(a,b){var c=!1;b instanceof RegExp&&(c=!0);for(var d=0;d<this.length;d++)if(c){if(this[d][a].match(b))return{index:d}}else if(this[d][a]===b)return{index:d};return!1},array.find=function(a,b,c){var d=0,e=new OGX.List,f=!1;b instanceof RegExp&&(f=!0),typeof c=="undefined"&&(c=0);for(var g=0;g<this.length;g++){f?this[g][a].match(b)&&(e.push(this[g]),d++):this[g][a]===b&&(e.push(this[g]),d++);if(c>0&&d===c)return c===1?e[0]:e}return e.length?e:!1},array.swap=function(a,b){var c=this[a];this[a]=this[b],this[b]=c},array.cache=function(a){indexes||(indexes={}),indexes[a]={};for(var b=0;b<this.length;b++)indexes[a][this[b][a]]=this[b]},array.uncache=function(a){if(!indexes)return!1;delete indexes[a]},array.read=function(a,b){return indexes?arguments.length?indexes[a][b]:indexes:!1},array.clear=function(){indexes=!1,filterCount=0,this.length=0},array.order=function(a,b){array.sort(dynamicSort(a,b))},array.group=function(a,b,c){if(Array.isArray(a))return array.groupm(a,b,c);var d,e={};for(var f=0;f<this.length;f++)d=extract(this[f],a,b,c),d&&(e.hasOwnProperty(d)||(e[d]=new OGX.List),e[d].push(this[f]));return e},array.groupm=function(a,b,c){function d(e,f){var g=new OGX.List(e),h=b,i=c;typeof b!="undefined"&&(Array.isArray(b)?h=b[f]:null),typeof c!="undefined"&&(Array.isArray(c)?i=c[f]:null);var j=g.group(a[f],h,i);if(f+1<=a.length-1)for(var k in j)j[k]=d(j[k],f+1);return j}var e=d(this,0);return e},array.filters={},array.addFilter=function(a,b,c){this.filters.hasOwnProperty(a)||(this.filters[a]=[]);var d={};return d[b]=c,this.filters[a].push(d),filterCount++,!0},array.removeFilter=function(a){return this.filters.hasOwnProperty(a)?(filterCount-=this.filters[a].length,delete this.filters[a],!0):!1},array.getFilters=function(){return this.filters},array.resetFilters=function(){this.filters={},filterCount=0},array.setFilters=function(a){this.resetFilters();for(var b in a)for(var c=0;c<a[b].length;c++)for(var d in a[b][c])array.addFilter(b,d,a[b][c][d])},array.setFilteringMode=function(a){filterMode=a},array.get=function(a,b,c,d){typeof b=="undefined"&&(b=!1),typeof c=="undefined"&&(c=!1),typeof c=="number"&&(d=c,c=!1),typeof d=="undefined"&&(d=0);var e=this.getFilters();this.resetFilters();for(var f in a)for(var g in a[f])this.addFilter(f,g,a[f][g]);var h=this.filter(d);this.resetFilters(),this.setFilters(e);if(b)for(var f in b){h.order(f,b[f]);break}return c?h.group.apply(null,c):h},array.filter=function(__limit){typeof __limit=="undefined"&&(__limit=0);var ar=[],isDate,isString,isArray,fnc,hasFilters=!1,reg=/[0-9]{4}\-[0-9]{2}\-[0-9]{2}( [0-9]{2}\:[0-9]{2}\:[0-9]{2})?/g,isMatch=!1,matches=0,str,o,err;for(var i=0;i<this.length;i++){isMatch=!0,matches=0;for(var a in this.filters){err=!1;try{o=null,str="this["+i+"]."+a,o=eval(str)}catch(error){err=!0}if(!err&&typeof o!="undefined"){hasFilters=!0,isDate=!1,isString=!1,isArray=Array.isArray(o),isArray?typeof o[0]=="string"&&(isString=!0,o[0].match(reg)&&(isDate=!0)):typeof o=="string"&&(isString=!0,o.match(reg)&&(isDate=!0));for(var j=0;j<this.filters[a].length;j++)for(var b in this.filters[a][j]){if(!String(this.filters[a][j][b]).length)matches++;else if(b==="function")isMatch=this.filters[a][j][b](o),isMatch&&matches++;else switch(b){case"eq":isDate?moment(o).format("YYYY-MM-DD")!==moment(this.filters[a][j][b]).format("YYYY-MM-DD")?isMatch=!1:matches++:isString?o.toLowerCase()!==String(this.filters[a][j][b]).toLowerCase()?isMatch=!1:matches++:o!==this.filters[a][j][b]?isMatch=!1:matches++;break;case"eqjson":JSON.stringify(o)!==JSON.stringify(this.filters[a][j][b])?isMatch=!1:matches++;break;case"neq":isDate?moment(o).format("YYYY-MM-DD")===moment(this.filters[a][j][b]).format("YYYY-MM-DD")?isMatch=!1:matches++:isString?o.toLowerCase()===this.filters[a][j][b].toLowerCase()?isMatch=!1:matches++:o===this.filters[a][j][b]?isMatch=!1:matches++;break;case"in":if(Array.isArray(this.filters[a][j][b])){for(var k=0;k<this.filters[a][j][b].length;k++)if(o.indexOf(this.filters[a][j][b][k])===-1){isMatch=!1;break}isMatch&&matches++}else isString?isArray?o.indexOf(this.filters[a][j][b])===-1?isMatch=!1:matches++:o.toLowerCase().indexOf(this.filters[a][j][b].toLowerCase())===-1?isMatch=!1:matches++:o.indexOf(this.filters[a][j][b])===-1?isMatch=!1:matches++;break;case"nin":if(Array.isArray(this.filters[a][j][b])){for(var k=0;k<this.filters[a][j][b].length;k++)if(o.indexOf(this.filters[a][j][b][k])!==-1){isMatch=!1;break}isMatch&&matches++}else isString?o.toLowerCase().indexOf(this.filters[a][j][b].toLowerCase())!==-1?isMatch=!1:matches++:o.indexOf(this.filters[a][j][b])!==-1?isMatch=!1:matches++;break;case"gt":isDate?moment(o).unix()<=moment(this.filters[a][j][b]).unix()?isMatch=!1:matches++:o<=this.filters[a][j][b]?isMatch=!1:matches++;break;case"gte":isDate?moment(o).unix()<moment(this.filters[a][j][b]).unix()?isMatch=!1:matches++:o<this.filters[a][j][b]?isMatch=!1:matches++;break;case"lt":isDate?moment(o).unix()>=moment(this.filters[a][j][b]).unix()?isMatch=!1:matches++:o>=this.filters[a][j][b]?isMatch=!1:matches++;break;case"lte":isDate?moment(o).unix()>moment(this.filters[a][j][b]).unix()?isMatch=!1:matches++:o>this.filters[a][j][b]?isMatch=!0:matches++;break;case"btw":isDate?moment(this.filters[a][j][b][0]).unix()>moment(o).unix()||moment(this.filters[a][j][b][1]).unix()<moment(o).unix()?isMatch=!1:matches++:this.filters[a][j][b][0]>o||this.filters[a][j][b][1]<o?isMatch=!1:matches++;break;case"substr":o.toLowerCase().substr(this.filters[a][j][b][0],this.filters[a][j][b][1]).toLowerCase()!==this.filters[a][j][b][2].toLowerCase()?isMatch=!1:matches++;break;case"regex":o.toString().match(this.filters[a][j][b])?matches++:isMatch=!1}if(!isMatch)break}}else isMatch=!1;filteringMode==="or"?isMatch&&ar.push(this[i]):matches===filterCount&&ar.push(this[i]);if(__limit&&ar.length===__limit)return OGX.List.apply(null,ar)}}return hasFilters?OGX.List.apply(null,ar):array},array}